<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProcureAqui Jobs - Angola</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Componente para renderizar ícones do Lucide
        const Icon = ({ name, className }) => {
            return <i data-lucide={name} className={className}></i>;
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('feed');
            const [jobs, setJobs] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [isRefreshing, setIsRefreshing] = useState(false);
            const [jobUrl, setJobUrl] = useState('');
            const [jobRawDescription, setJobRawDescription] = useState('');
            const [jobTitle, setJobTitle] = useState('');
            const [generatedPost, setGeneratedPost] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const [copySuccess, setCopySuccess] = useState(false);

            const apiKey = ""; 
            const BASE_FEED_URL = "https://www.procureaqui.net/?feed=job_feed&job_types=estagio%2Cfreelance%2Cpart-time%2Ctempo-inteiro&search_location&job_categories&search_keywords";

            // Inicialização e atualização de ícones
            useEffect(() => {
                if (activeTab === 'feed' && jobs.length === 0) fetchJobs();
                if (window.lucide) window.lucide.createIcons();
            }, [activeTab, jobs, generatedPost, isRefreshing, loading]);

            const fetchJobs = async (isManual = false) => {
                try {
                    if (isManual) setIsRefreshing(true);
                    else setLoading(true);
                    setError(null);
                    
                    const response = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(BASE_FEED_URL)}&_t=${Date.now()}`);
                    const data = await response.json();
                    
                    if (data.status === 'ok') {
                        setJobs(data.items.slice(0, 8).map(item => ({
                            id: item.guid || Math.random().toString(36).substr(2, 9),
                            title: item.title,
                            link: item.link,
                            description: item.description,
                            pubDate: new Date(item.pubDate).toLocaleDateString('pt-BR'),
                        }))); 
                    } else throw new Error('Falha no feed.');
                } catch (err) {
                    setError("Erro ao carregar vagas.");
                    console.error(err);
                } finally {
                    setLoading(false);
                    setIsRefreshing(false);
                }
            };

            const generateSocialPost = async () => {
                if (!jobUrl) return;
                setIsGenerating(true);
                setGeneratedPost('');

                const systemPrompt = `Você é um formatador de texto literal. Sua ÚNICA função é organizar o conteúdo fornecido sem alterar uma única letra.
REGRAS CRÍTICAS:
1. Use o título fornecido exatamente como está.
2. Abaixo de 'Descrição da vaga:', insira o texto da descrição original fornecida.
3. Use APENAS as primeiras 5 linhas do texto original, mantendo a pontuação e palavras EXATAS.
4. Se o texto original contiver HTML, remova as tags, mas mantenha o texto original puro.
5. NÃO use emojis, NÃO use negritos (**), NÃO use Markdown.
6. Adicione o link e as tags ao final.`;

                try {
                    if (!apiKey) {
                        // Fallback caso não haja API Key
                        const lines = jobRawDescription.split('\n').filter(l => l.trim() !== '').slice(0, 5).join('\n');
                        setGeneratedPost(`${jobTitle}\n\nDescrição da vaga:\n${lines}\n\nClique aqui para ver mais: ${jobUrl} / .\n#vagasangola #empregoangola #luanda #procureaqui`);
                        return;
                    }

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `TÍTULO: ${jobTitle}\nDESCRIÇÃO ORIGINAL: ${jobRawDescription}\nURL: ${jobUrl}` }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] }
                        })
                    });
                    const data = await response.json();
                    setGeneratedPost(data.candidates?.[0]?.content?.parts?.[0]?.text || "Erro na geração.");
                } catch (err) {
                    setError("Erro ao processar post.");
                } finally {
                    setIsGenerating(false);
                }
            };

            const copyToClipboard = () => {
                const textArea = document.createElement("textarea");
                textArea.value = generatedPost;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                setCopySuccess(true);
                setTimeout(() => setCopySuccess(false), 2000);
            };

            const sanitizeDescription = (html) => {
                const doc = new DOMParser().parseFromString(html, 'text/html');
                return doc.body.textContent || "";
            };

            return (
                <div className="min-h-screen p-4 md:p-8">
                    <div className="max-w-3xl mx-auto">
                        <header className="mb-8 text-center">
                            <div className="inline-flex p-4 bg-blue-600 rounded-3xl mb-4 shadow-xl shadow-blue-200">
                                <Icon name="briefcase" className="text-white w-8 h-8" />
                            </div>
                            <h1 className="text-4xl font-extrabold text-slate-800">ProcureAqui <span className="text-blue-600">Jobs</span></h1>
                            <div className="flex justify-center mt-8 p-1 bg-white border rounded-2xl w-fit mx-auto shadow-sm">
                                <button onClick={() => setActiveTab('feed')} className={`px-6 py-2 rounded-xl text-sm font-bold flex items-center ${activeTab === 'feed' ? 'bg-blue-600 text-white' : 'text-slate-700'}`}> 
                                    <Icon name="layout-list" className="w-4 h-4 mr-2" /> Feed
                                </button>
                                <button onClick={() => setActiveTab('generator')} className={`px-6 py-2 rounded-xl text-sm font-bold flex items-center ${activeTab === 'generator' ? 'bg-blue-600 text-white' : 'text-slate-700'}`}> 
                                    <Icon name="wand-2" className="w-4 h-4 mr-2" /> Gerador
                                </button>
                            </div>
                        </header>

                        {activeTab === 'feed' ? (
                            <div className="space-y-4">
                                <div className="flex justify-between items-center mb-2 px-2">
                                    <h2 className="text-xs font-bold text-slate-500 uppercase tracking-wider">Últimas Atualizações</h2>
                                    <button 
                                        onClick={() => fetchJobs(true)}
                                        disabled={loading || isRefreshing}
                                        className="flex items-center text-xs font-bold text-blue-600 hover:text-blue-800 transition-colors disabled:opacity-50"
                                    >
                                        <Icon name="refresh-cw" className={`w-3.5 h-3.5 mr-1.5 ${isRefreshing ? 'animate-spin' : ''}`} />
                                        {isRefreshing ? "A buscar..." : "Atualizar agora"}
                                    </button>
                                </div>

                                {loading ? (
                                    <div className="flex flex-col items-center justify-center py-20 bg-white rounded-3xl border border-slate-100 shadow-sm">
                                        <div className="w-10 h-10 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"></div>
                                        <p className="text-slate-400 font-medium text-sm">Sincronizando feed de Angola...</p>
                                    </div>
                                ) : error ? (
                                    <div className="bg-white border border-red-100 p-8 rounded-3xl text-center">
                                        <p className="text-red-600 font-bold">{error}</p>
                                        <button onClick={() => fetchJobs()} className="mt-4 px-4 py-2 bg-red-600 text-white rounded-xl text-sm font-bold">Tentar novamente</button>
                                    </div>
                                ) : (
                                    jobs.map(job => (
                                        <div key={job.id} className="bg-white p-6 rounded-3xl border shadow-sm hover:border-blue-200 transition-all group">
                                            <div className="flex justify-between items-start mb-2">
                                                <h2 className="text-xl font-bold leading-tight group-hover:text-blue-600 transition-colors">{job.title}</h2>
                                                <span className="text-[10px] font-bold bg-slate-50 text-slate-400 px-2 py-1 rounded-lg shrink-0 flex items-center">
                                                    <Icon name="calendar" className="w-3 h-3 mr-1" /> {job.pubDate}
                                                </span>
                                            </div>
                                            <p className="text-slate-600 text-sm mb-4 line-clamp-3 leading-relaxed">{sanitizeDescription(job.description)}</p>
                                            <div className="flex justify-between items-center border-t pt-4">
                                                <button onClick={() => {
                                                    setJobUrl(job.link);
                                                    setJobTitle(job.title);
                                                    setJobRawDescription(sanitizeDescription(job.description));
                                                    setActiveTab('generator');
                                                }} className="text-blue-600 font-bold text-sm flex items-center hover:bg-blue-50 px-2 py-1 rounded-lg transition-colors">
                                                    <Icon name="share-2" className="w-4 h-4 mr-1" /> Criar Post Literal
                                                </button>
                                                <a href={job.link} target="_blank" rel="noopener noreferrer" className="text-blue-600 font-bold text-sm flex items-center">
                                                    Ver Vaga <Icon name="external-link" className="w-3.5 h-3.5 ml-1" />
                                                </a>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        ) : (
                            <div className="bg-white p-8 rounded-3xl border shadow-sm">
                                <h2 className="text-2xl font-bold text-slate-800 mb-6 flex items-center">
                                    <Icon name="send" className="w-6 h-6 mr-3 text-blue-600" /> Cópia Fiel do Site
                                </h2>
                                <label className="block text-sm font-bold text-slate-700 mb-2">Link da Vaga:</label>
                                <input 
                                    type="url" 
                                    value={jobUrl}
                                    onChange={(e) => setJobUrl(e.target.value)}
                                    placeholder="Link da vaga..."
                                    className="w-full bg-slate-50 border p-3 rounded-2xl mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                                <button 
                                    onClick={generateSocialPost}
                                    disabled={isGenerating || !jobUrl}
                                    className="w-full bg-blue-600 text-white py-3 rounded-2xl font-bold hover:bg-blue-700 disabled:opacity-50 shadow-lg shadow-blue-100 flex justify-center items-center"
                                >
                                    {isGenerating ? <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div> : "Formatar Post Literal"}
                                </button>

                                {generatedPost && (
                                    <div className="mt-6">
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="text-sm font-bold text-blue-600 flex items-center italic">
                                                <Icon name="wand-2" className="w-4 h-4 mr-2" /> Texto Extraído (5 Linhas):
                                            </span>
                                            <button onClick={copyToClipboard} className="text-xs font-bold bg-slate-100 px-4 py-2 rounded-xl hover:bg-slate-200 transition-all">
                                                {copySuccess ? "Copiado!" : "Copiar Texto"}
                                            </button>
                                        </div>
                                        <pre className="bg-slate-50 p-6 rounded-3xl border-2 border-dashed border-slate-200 text-sm whitespace-pre-wrap font-sans leading-relaxed border-l-4 border-l-blue-600">
                                            {generatedPost}
                                        </pre>
                                    </div>
                                )}
                            </div>
                        )}
                        <footer className="mt-16 pb-8 text-center text-slate-400 text-[10px] tracking-widest uppercase font-bold">
                            <p>© {new Date().getFullYear()} ProcureAqui • Angola Jobs Hub</p>
                        </footer>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>