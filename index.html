<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProcureAqui Jobs - Angola</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Mocking Lucide icons for the CDN environment
        const Icon = ({ name, className }) => {
            return <i data-lucide={name} className={className}></i>;
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('feed');
            const [jobs, setJobs] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [isRefreshing, setIsRefreshing] = useState(false);
            const [jobUrl, setJobUrl] = useState('');
            const [jobRawDescription, setJobRawDescription] = useState('');
            const [jobTitle, setJobTitle] = useState('');
            const [generatedPost, setGeneratedPost] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const [copySuccess, setCopySuccess] = useState(false);

            const apiKey = ""; 
            const BASE_FEED_URL = "https://www.procureaqui.net/?feed=job_feed&job_types=estagio%2Cfreelance%2Cpart-time%2Ctempo-inteiro&search_location&job_categories&search_keywords";

            useEffect(() => {
                if (activeTab === 'feed' && jobs.length === 0) fetchJobs();
                // Initialize Lucide icons after render
                if (window.lucide) window.lucide.createIcons();
            }, [activeTab, jobs, generatedPost]);

            const fetchJobs = async (isManual = false) => {
                try {
                    if (isManual) setIsRefreshing(true);
                    else setLoading(true);
                    setError(null);
                    const response = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(BASE_FEED_URL)}&_t=${Date.now()}`);
                    const data = await response.json();
                    if (data.status === 'ok') {
                        setJobs(data.items.slice(0, 8).map(item => ({
                            id: item.guid || Math.random().toString(36).substr(2, 9),
                            title: item.title,
                            link: item.link,
                            description: item.description,
                            pubDate: new Date(item.pubDate).toLocaleDateString('pt-BR'),
                        })));
                    } else throw new Error('Falha no feed.');
                } catch (err) {
                    setError("Erro ao carregar vagas.");
                } finally {
                    setLoading(false);
                    setIsRefreshing(false);
                }
            };

            const generateSocialPost = async () => {
                if (!jobUrl) return;
                setIsGenerating(true);
                setGeneratedPost('');

                const systemPrompt = `Você é um formatador de texto literal. Sua ÚNICA função é organizar o conteúdo fornecido sem alterar uma única letra.
REGRAS CRÍTICAS:
1. Use o título fornecido exatamente como está.
2. Abaixo de 'Descrição da vaga:', insira o texto da descrição original fornecida.
3. Use APENAS as primeiras 5 linhas do texto original, mantendo a pontuação e palavras EXATAS. Não resuma. Não parafraseie.
4. Se o texto original contiver HTML, remova as tags, mas mantenha o texto original puro.
5. NÃO use emojis, NÃO use negritos (**), NÃO use Markdown.
6. Adicione o link e as tags ao final.
Estrutura:
[TÍTULO]
Descrição da vaga:
[5 LINHAS LITERAIS]
Clique aqui para ver mais: [URL] / .
#vagasangola #empregoangola #luanda #procureaqui`;

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `TÍTULO: ${jobTitle}\nDESCRIÇÃO ORIGINAL: ${jobRawDescription}\nURL: ${jobUrl}` }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] }
                        })
                    });
                    const data = await response.json();
                    setGeneratedPost(data.candidates?.[0]?.content?.parts?.[0]?.text || "Erro na geração.");
                } catch (err) {
                    setError("Erro ao processar post.");
                } finally {
                    setIsGenerating(false);
                }
            };

            const copyToClipboard = () => {
                const textArea = document.createElement("textarea");
                textArea.value = generatedPost;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                setCopySuccess(true);
                setTimeout(() => setCopySuccess(false), 2000);
            };

            const sanitizeDescription = (html) => {
                const doc = new DOMParser().parseFromString(html, 'text/html');
                return doc.body.textContent || "";
            };

            return (
                <div className="min-h-screen p-4 md:p-8">
                    <div className="max-w-3xl mx-auto">
                        <header className="mb-8 text-center">
                            <div className="inline-flex p-4 bg-blue-600 rounded-3xl mb-4 shadow-xl shadow-blue-200">
                                <Icon name="briefcase" className="text-white w-8 h-8" />
                            </div>
                            <h1 className="text-4xl font-extrabold text-slate-800">ProcureAqui <span className="text-blue-600">Jobs</span></h1>
                            <div className="flex justify-center mt-8 p-1 bg-white border rounded-2xl w-fit mx-auto shadow-sm">
                                <button onClick={() => setActiveTab('feed')} className={`px-6 py-2 rounded-xl text-sm font-bold flex items-center ${activeTab === 'feed' ? 'bg-blue-600 text-white' : 'text-slate-500'}`}>
                                    <Icon name="layout-list" className="w-4 h-4 mr-2" /> Feed
                                </button>
                                <button onClick={() => setActiveTab('generator')} className={`px-6 py-2 rounded-xl text-sm font-bold flex items-center ${activeTab === 'generator' ? 'bg-blue-600 text-white' : 'text-slate-500'}`}>
                                    <Icon name="wand-2" className="w-4 h-4 mr-2" /> Gerador
                                </button>
                            </div>
                        </header>

                        {activeTab === 'feed' ? (
                            <div className="space-y-4">
                                {loading ? <div className="text-center py-10">Carregando...</div> :
                                 jobs.map(job => (
                                    <div key={job.id} className="bg-white p-6 rounded-3xl border shadow-sm">
                                        <h2 className="text-xl font-bold mb-2">{job.title}</h2>
                                        <p className="text-slate-600 text-sm mb-4 line-clamp-3">{sanitizeDescription(job.description)}</p>
                                        <div className="flex justify-between items-center border-t pt-4">
                                            <button onClick={() => {
                                                setJobUrl(job.link);
                                                setJobTitle(job.title);
                                                setJobRawDescription(sanitizeDescription(job.description));
                                                setActiveTab('generator');
                                            }} className="text-blue-600 font-bold text-sm flex items-center">
                                                <Icon name="share-2" className="w-4 h-4 mr-1" /> Criar Post
                                            </button>
                                            <a href={job.link} target="_blank" className="text-blue-600 font-bold text-sm">Ver Vaga</a>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="bg-white p-8 rounded-3xl border shadow-sm">
                                <input 
                                    type="url" 
                                    value={jobUrl}
                                    onChange={(e) => setJobUrl(e.target.value)}
                                    placeholder="Link da vaga..."
                                    className="w-full bg-slate-50 border p-3 rounded-2xl mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                                <button 
                                    onClick={generateSocialPost}
                                    disabled={isGenerating || !jobUrl}
                                    className="w-full bg-blue-600 text-white py-3 rounded-2xl font-bold hover:bg-blue-700 disabled:opacity-50"
                                >
                                    {isGenerating ? "Processando..." : "Formatar Post Literal"}
                                </button>

                                {generatedPost && (
                                    <div className="mt-6">
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="text-sm font-bold text-blue-600">Cópia Fiel (5 Linhas):</span>
                                            <button onClick={copyToClipboard} className="text-xs font-bold bg-slate-100 px-3 py-1 rounded-lg">
                                                {copySuccess ? "Copiado!" : "Copiar"}
                                            </button>
                                        </div>
                                        <pre className="bg-slate-50 p-4 rounded-2xl border-2 border-dashed text-sm whitespace-pre-wrap font-sans">
                                            {generatedPost}
                                        </pre>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
